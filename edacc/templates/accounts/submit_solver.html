{% from "_formhelpers.html" import render_field %}
{% extends "base.html" %}
{% block title %}Submit Solver{% endblock %}
{% block head %}
    {{ super() }}
    <script type="text/javascript">
        $(document).ready(function() {
            $("#solver_form").submit(function() {
                if (!$.trim($('#name').val())) {
                    alert("Name is required.");
                    return false;
                }
                if (!$.trim($('#version').val())) {
                    alert("Version is required.");
                    return false;
                }
                if (!$.trim($('#authors').val())) {
                    alert("Authors is required.");
                    return false;
                }
                {% if not id %} // only check for uploads on new solvers
                if (!$.trim($('#description_pdf').val())) {
                    alert("Description ZIP is required.");
                    return false;
                }
                if (!$.trim($('#code').val())) {
                    alert("Please upload a code archive.");
                    return false;
                }
                {% endif %}
                if (!$('#competition_categories').val()) {
                    alert("You have to specify at least one competition category.");
                    return false;
                }
                if (!$.trim($('#parameters').val())) {
                    alert("You have to specify INSTANCE as parameter.");
                    return false;
                }
            });
        });
    </script>
{% endblock %}
{% block content %}
    <h2>Submit Solver</h2>
    <div>
        <img alt="Info" title="Info" src="{{url_for('static', filename='img/info.png')}}" /> <strong>Important:</strong>
        The code archive should be a ZIP (application/zip MIME type) archive that contains a build.sh script which<br/>
        compiles the code within a "code/" subfolder and puts the executables into a "binary/" subfolder.<br/><br/>
        <strong>Regarding temporary files:</strong> Please note that you should use the directory given as parameter TEMPDIR,<br/>
        which will be a unique and clean directory for every solver run. Because your solver might concurrently run more than<br/>
        once on a machine, simply using /tmp might result in conflicts. You should also avoid to write to your solver's own<br/>
        directory for the same reason.
    </div>
    {% if id %}
    <div>
        <img alt="Info" title="Info" src="{{url_for('static', filename='img/info.png')}}" /><strong>
        You are about to submit a new version of a solver you previously submitted. All results of the solver will be deleted and new test jobs generated once we compiled the new version.<br/>
        If you don't provide new code or description zip, the old one will be used.</strong>
    </div>
    {% endif %}
    <form id="solver_form" action="{{url_for('accounts.submit_solver', database=database, id=id)}}" method="post" enctype="multipart/form-data">
        {{ form.csrf_token }}
        <table width="800px">
            {{ render_field(form.name, size=40, maxlength=255, explanation="<strong>Required</strong>", required=True) }}
            {{ render_field(form.version, size=40, maxlength=255, explanation="<strong>Required</strong>", required=True) }}
            {{ render_field(form.authors, size=40, maxlength=255, explanation="<strong>Required</strong>", required=True) }}
            {{ render_field(form.description, cols=38, rows=5, explanation="Optional short description") }}
            {{ render_field(form.description_pdf, size=40, explanation="<strong>Required</strong> .zip file", required=True) }}
            {{ render_field(form.code, size=40, required=True) }}
            {{ render_field(form.competition_launch_command, size=40, maxlength=255, required=True, explanation="Run command of your solver <strong>within the binary/ folder<strong>, excluding the parameters (Parameters are specified below). For example \"./binaryName\" or \"java -jar binary.jar\".") }}
            {{ render_field(form.parameters, size=40, explanation="<strong>Required</strong>", required=True) }}
            <tr>
                <td></td>
                <td>Please provide the parameters your solver should use here.
                    You can use INSTANCE, TEMPDIR and SEED as variables in the parameter specification. INSTANCE is required.
                    The system will substitute the instance filename and RNG seed in the specified place when your solver is run.
                    Your parameter specification will be parsed according to whitespace characters.
                    TEMPDIR should be used for temporary files.
                    <div>Example:<br/>
                    <span class="command">"INSTANCE -s SEED -tmp TEMPDIR -wp 0.05 -flag1"</span> will result in e.g. <span class="command">"./binaryName inst1.cnf -s 6441654 -tmp /some/writable/directory -wp 0.05 -flag1"</span>.
                    </div>
                </td>
            </tr>
            {{ render_field(form.unsat_parameters, size=40, explanation="<strong>Additional</strong> parameters when running in UNSAT tracks", required=True) }}
            {{ render_field(form.competition_categories, size=8, explanation='<strong>Required</strong>. Hold the Ctrl key to select multiple categories. Select either any subset of the sequential tracks, or any subset of the parallel track, or the MiniSAT hack-track.', required=True) }}
        </table>
        {% if error %}<div style="color: red;"><b>Error: {{error}}</b></div>{% endif %}
        <input id="submit" type="submit" value="Submit" />
    </form>

{% endblock %}
